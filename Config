# -*-perl-*-

package.LookoutMitigationService = {
    interfaces = (1.0);
    scope = webservices;
    
    build-system = happytrails;
    build-environment = {
        chroot = basic;
        network-access = blocked;
    };

    build-tools = {
        1.0 = {
            JDK8 = 1.0;
            HappierTrails = 3.3;
            # Build logic for spring integration
            CoralSpringLauncher = 4.0;
            AWSSimpleWorkflowJavaFlowDeciderAPT = 3.2;
        };
    };
    
    deploy = {
        generic = true;
    };

    dependencies = {
        1.0 = {
            CoralActivity = 1.0;
            CoralSpring = 4.0;
            JakartaCommons-logging-api = 1.1;
            JakartaCommons-lang3 = 3.x;
            FindBugsAnnotations = 1.3.7;
            
            AWSJavaSDKExternalRelease = 1.9;
            LookoutMitigationWorkFlowWorker = 1.0;

            CoralAwsAuthentication = 1.1; # To support authenticating/authorizing calls to LookoutMitigationService.
            OdinAWSCredentials = 1.3;
            
            AWS158Commons = 1.1;
            DaasControlAPIServiceJavaClient = 1.0;
            EdgeOperatorServiceJavaClient = 1.0;
            
            OWASPOutputEncoder = 1.0; # Dependency on the binaryTrie implementation in this package, used for subnet matching.
            LookoutMitigationServiceCommons = 1.0;
            LookoutMitigationServiceModel = 1.0;
            
            JavaAmazonLdapUtils = 1.2;
            CoralSpringLauncher = 4.0;
            CoralClientHttp = 1.0;

            LookoutMitigationServiceExplorer = 1.0;
            LookoutRouterMitigationCommons = 1.0;
            
            LookoutMWSClientJava = 1.0;
        };
    };
    
    runtime-dependencies = {
        1.0 = {
            JDK8 = 1.0;
            # Runtime dependencies for coral
            JakartaCommons-logging-adapters = 1.1;
            Bobcat = 2.0;
            CoralSpringDirector = 1.0;
            
            CoralService = 1.0;
            CoralMetricsQuerylogReporter = 1.0;            
            # Coral protocol handlers
            CoralRpcSupport = 1.0;                          
            LookoutMitigationServiceExplorer = 1.0;
            
            # ProcessManager.
            ProcessManager = 2.2;
            ProcessManagerCommands = 2.2;
            ProcessManagerBrazilConfig = 1.0;
            ForceRestartProcessManagerCmds = 1.0;
            BrazilConfigGlobal = 1.0;
            
            MonitoringCore = 1.0;
            ServiceMonitoring = 2.0;
            
            WebsiteLogPusher = 3.2;        
            
            EdgeSetupVLANIptables = 1.0;      
            
            # rotate PMAdmin and GC logs
            CronologRotateLogHourlyScripts = 1.0;                                
        };
    };

    test-dependencies = {
        1.0 = {
            junit = 4.12;
            Mockito = 1.10.x;
            # For TOD-based approval step in the pipeline
            LookoutMitigationServiceMonitor = 1.0;
        };
    };

    resolves-conflict-dependencies = {
        1.0 = {
            CoralSpring = 4.0;
            CoralSpringLauncher = 4.0;
            JakartaCommons-codec = 1;
            log4j = 1.2;
            Lombok = 1.14.x;
            Mockito = 1.10.x;
            OdinAWSCredentials = 1.3;
            Openssl = 1.0.x;
            SpringBeans = 4.0.x;
            SpringCore = 4.0.x;
            SpringContext = 4.0.x;
        };
    };
    
    # Removing j2ee dependency based on the known issue documented here: https://w.amazon.com/index.php/Coral/Manual/Bobcat2Migration#Known_Behavior_Changes
    remove-dependencies = {
          1.0 = {
            j2ee = 1.0; 
          };
    };

    # For more information on how to declare targets for HappyTrails packages
    # see: https://w.amazon.com/?BrazilBuildSystem/HappyTrails/GettingStarted
    targets = {
        LookoutMitigationService-1.0 = { type = javalibrary; };
    };
};
