# -*-perl-*-

package.LookoutMitigationService = {
    interfaces = (1.0);
    scope = webservices;
    
    build-system = templates-then-happytrails;
    build-environment = {
        chroot = basic;
        network-access = blocked;
    };

    build-tools = {
        1.0 = {
            JDK8 = 1.0;
            HappierTrails = 3.4;
            Lombok = 1.16.x;
            LombokUtils = 1.1;
            # Build logic for spring integration
            CoralSpringLauncher = 4.3;
            CoralGenerator = 1.2;
            DynamoDBLocal = 1.11.x;
            DynamoDBLocalBuildLogic = 1.2;
            LookoutMitigationServiceLocationConfiguration = 1.0;
            TemplateConfigGenerator = 1.0;
            LogScanUtils = 1.0;
        };
    };
    
    deploy = {
        generic = true;
    };

    dependencies = {
        1.0 = {
            StreamEx = 1.0;
            AmazonResourceNameJava = 1.0;
            CoralActivity = 1.1;
            CoralSpring = 4.3;
            JakartaCommons-logging-api = 1.1;
            JakartaCommons-lang3 = 3.x;
            FindBugsAnnotations = 3.1.0;
            
            CoralAwsAuthentication = 1.3; # To support authenticating/authorizing calls to LookoutMitigationService.
            OdinAWSCredentials = 1.4;
            Cachemere = 1.2;
            CachemereJakalPlugin = 1.4;

            LookoutMitigationServiceCommons = 1.0;
            LookoutMitigationServiceModel = 1.0;
            HostStatusCommon = 1.0;
            BlackWatchLocationStateCommons = 1.0;
            BlackWatchMitigationCommons = 1.0;
            
            CoralSpringLauncher = 4.3;
            CoralQueryStringValue = 1.1;
            CoralTibcoValue = 1.1;

            LookoutBlackWatchHostConfig = 1.0;

            LookoutMitigationServiceExplorer = 1.0;
            LookoutNetworkInformationManager = 1.1;
            LookoutMitigationServiceJlbRelayConfig = 1.0;
            CoralSslProxySupport = 1.1;
            RIPJavaHelper = 1.2;
            BlackWatchBorderLocationConfig = 1.0;
            LookoutMWSClientJava = 1.0;

        };
    };
    
    runtime-dependencies = {
        1.0 = {
            LookoutMitigationServiceLocationConfiguration = 1.0;
            JDK8 = 1.0;
            # Runtime dependencies for coral
            JakartaCommons-logging-adapters = 1.1;
            Bobcat = 2.2;

            CoralSpringDirector = 4.3;
            CoralService = 1.1;
            # Coral protocol handlers
            CoralRpcSupport = 1.1;                          
            CoralClientSpringSupport = 4.3;

            CoralThrottle = 1.1;
            CoralAvailabilityEmbedded = 1.1;

            # ProcessManager.
            ProcessManager = 2.2;
            ProcessManagerCommands = 2.2;
            ProcessManagerBrazilConfig = 1.0;
            ForceRestartProcessManagerCmds = 1.0;
            BrazilConfigGlobal = 1.0;
            
            MonitoringCore = 1.0;
            ServiceMonitoring = 2.0;
            AwsDynamoDBMetricsHelpersLib = 1.11.x;
            
            WebsiteLogPusher = 3.4;

            # Register with Turtle during Preactivate
            TurtleRegistrationApolloCmd = 1.0;
            
            EdgeSetupVLANIptables = 1.0;      
            
            # rotate PMAdmin and GC logs
            CronologRotateLogHourlyScripts = 1.0;
            AmazonCACerts = 1.0;

            CacheOut = 1.0;
            
            # Log4j2
            AmazonFileAppenderJava = 2.8;
            Jcl-over-log4j2 = 2.x;
            Jul-over-log4j2 = 2.x;
            Log4j-1_2-api = 2.8;
            Log4j-slf4j = 2.x;
            Disruptor = 3.3.x;    
            AmazonAppConfigJava = 2.0; # For resolves-conflict-dependencies
            CoralBuffer = 1.1; # For resolves-conflict-dependencies
            CoralDiscovery = 1.1; # For resolves-conflict-dependencies
            CoralIO = 1.1; # For resolves-conflict-dependencies
            CoralMetricsReporter = 1.1; # For resolves-conflict-dependencies
            CoralThrottleCommon = 1.1; # For resolves-conflict-dependencies
            CoralThrottleEngine = 1.1; # For resolves-conflict-dependencies
            CoralUtil = 1.1; # For resolves-conflict-dependencies
            JakartaCommons-logging = 1.2; # For resolves-conflict-dependencies
            log4j = 2.8;
        };
    };

    test-dependencies = {
        1.0 = {
            junit = 4.12;
            Mockito = 1.10.x;
            JUnitParams = 1.x;
            LookoutTestCommons = 1.0;
            DynamoDBLocal = 1.11.x;
            Log4j-core = 2.8; # For resolves-conflict-dependencies
            JUnit-4-12-migration = 5.x;
        };
    };

    resolves-conflict-dependencies = {
        1.0 = {
            JakartaCommons-logging = 1.2;
            CoralSpring = 4.3;
            GoogleGuava = 21.x;
            JakartaCommons-codec = 1;
            log4j = 2.8;
            Log4j-core = 2.8;
            JakartaCommons-httpclient = 3.1;

            Jackson-databind = 2.8.x;
            Javassist = 3.20.x;


            # Coral 1.1
            CoralBuffer = 1.1;

            Zlib = 1;


            AmazonFileAppenderJava = 2.8;
            AmazonApolloEnvironmentInfoJava = 1.2;
            AmazonAppConfigJava = 2.0;
            CoralCore = 1.1;
            CoralDiscovery = 1.1;
            CoralHttpSupport = 1.1;
            CoralIO = 1.1;
            CoralMetricsQuerylogReporter = 1.1;
            CoralMetricsReporter = 1.1;
            CoralModeledExceptions = 1.1;
            CoralService = 1.1;
            CoralThrottleCommon = 1.1;
            CoralThrottleEngine = 1.1;
            CoralUtil = 1.1;
            CoralRetry = 2.0;
            CoralClientOdinSupport = 1.2;
            CoralRpcSupport = 1.1;
            OdinAWSCredentials = 1.4;
            CoralQueryStringValue = 1.1;
            CoralTibcoValue = 1.1;
            CoralClientCall = 1.1;
            CoralIdentity = 1.1;
            AWS158Metrics = 1.1;
            Log4j-1_2-api = 2.8;
        };
    };

    # Removing j2ee dependency based on the known issue documented here: https://w.amazon.com/index.php/Coral/Manual/Bobcat2Migration#Known_Behavior_Changes
    remove-dependencies = {
          1.0 = {
          };
    };

    # For more information on how to declare targets for HappyTrails packages
    # see: https://w.amazon.com/?BrazilBuildSystem/HappyTrails/GettingStarted
    targets = {
        LookoutMitigationService-1.0 = { type = javalibrary; };
    };
};
