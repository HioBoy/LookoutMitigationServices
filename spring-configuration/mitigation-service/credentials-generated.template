<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

    <!-- Credentials we use to assume the roles below -->
    <bean id="elbInternalServiceRolesUserCredentialsProvider" class="amazon.odin.awsauth.OdinAWSCredentialsProvider">
        <constructor-arg name="materialSetName" value="com.amazon.blackwatch.elb.private_api_user.${realm}.${domain}"/>
    </bean>
    <!-- Roles to assume for ELB internal Services -->
{% for stack in locations.values() %}
    {% for realm_domain, location in stack.items() %}
    <bean id="elbInternalServiceCredentialsProvider.{{ realm_domain }}" class="com.amazonaws.auth.STSAssumeRoleSessionCredentialsProvider">
        <constructor-arg name="longLivedCredentialsProvider" ref="elbInternalServiceRolesUserCredentialsProvider"/>
        <constructor-arg name="roleSessionName" value="ELBInternalAPIRoleSession"/>
        <constructor-arg name="roleArn" value="{{ location['elb_internal_api_role'] }}"/>
    </bean>
    {% endfor %}
{% endfor %}

</beans>
