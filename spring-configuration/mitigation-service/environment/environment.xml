<?xml version="1.0" encoding="UTF-8"?>
<beans
    xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

    <!--                                                                           
        The EnvironmentHelper makes Apollo Manifest, Environment Variables and  
        System Properties available to your configuration as Property              
        Placeholders. This means you can use variables like ${domain} or ${root}
        in your Spring configuration.                                              
    -->                                                                            
    <bean id="Environment" class="com.amazon.coral.spring.EnvironmentHelper"/>  

    <bean class="com.amazon.lookout.mitigation.service.spring.StageStringFactoryBean" id="stageFactory" depends-on="Environment">
        <property name="stageName" value="${stage}" />                          
    </bean>                                                                     

    <!--
    The MetricsFactory is an aide that will help you configure Querylog
    support for your application.
    See https://w.amazon.com/?Coral/Manual/MetricsAPI
    -->
    <bean id="metricsFactory" class="com.amazon.coral.metrics.helper.MetricsHelper">
        <property name="reporters">
            <list>
                <bean class="com.amazon.coral.metrics.helper.QuerylogHelper">
                    <property name="filename" value="${root}/var/output/logs/service_log"/>
                </bean>
            </list>
        </property>
        <property name="program" value="LookoutMitigationService"/>
        <property name="marketplace" ref="marketplaceName"/>
    </bean>

    <!--  Initialize AppConfig -->
    <bean name="appConfigHelper" class="amazon.platform.config.AppConfigHelper" init-method="initialize" depends-on="stageFactory">
        <property name="appName" value="LookoutMitigationService"/>
        <property name="domain" value="${domain}"/>
        <property name="realm" value="${realm}"/>
        <property name="root" value="${root}"/>
        <property name="overrides" value="${root}/brazil-config/override/CoralEmbeddedThrottle-#{stageFactory}-base.cfg, ${root}/brazil-config/override/CoralEmbeddedThrottle-#{stageFactory}-global.cfg"/>
    </bean>

</beans>
